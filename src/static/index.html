<!DOCTYPE html>
<html>

<head>
  <title>Ponk</title>
  <style>
    .qr a {
      display: block;
    }

    .qr a,
    .svg {
      width: fit-content;
    }
  </style>
</head>

<body>
  <h1>Display</h1>

  <div id="player1">
    <div class="qr">
      <p>Scan QR code to connect</p>
      <a href="/1" target="_blank">
        <div class="svg"></div>
      </a>
    </div>
    <pre class="output"></pre>
  </div>

  <div id="player2">
    <div class="qr">
      <p>Scan QR code to connect</p>
      <a href="/2" target="_blank">
        <div class="svg"></div>
      </a>
    </div>
    <pre class="output"></pre>
  </div>

  <script src="/js/qrcode.min.js"></script>
  <script>
    [1, 2].forEach((i) => {
      var qrcode = new QRCode({
        content: new URL(i, window.location.href).toString(),
        container: "svg", //Responsive use
        join: true //Crisp rendering and 4-5x reduced file size
      });
      var svg = qrcode.svg();
      document.querySelector(`#player${i} .svg`).innerHTML = svg;
    });
  </script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io({ query: { role: 'display', width: 800, height: 800 } });

    let started = false;

    socket.on('game', (game) => {
      if (!started) {
        document.querySelector('#player1 .qr').style.display = 'none';
        document.querySelector('#player2 .qr').style.display = 'none';

        started = true;
      }

      // TODO: Show the puck and paddles visually
      document.querySelector('#player1 .output').textContent = game.p1;
      document.querySelector('#player2 .output').textContent = game.p2;
    });
  </script>
</body>

</html>
